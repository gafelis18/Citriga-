<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Crear Contrato / Seleccionar Proveedor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 10px;
      background: #f4f4f4;
    }
    h2 {
      color: #2a7ae2;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input, select, textarea, button {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border-radius: 5px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    .two-columns {
      display: flex;
      gap: 10px;
    }
    .two-columns > div {
      flex: 1;
    }
    .result {
      margin-top: 20px;
      padding: 10px;
      background: #e8f0fe;
      border: 1px solid #c2dbff;
      border-radius: 5px;
    }
    button {
      background-color: #2a7ae2;
      color: white;
      font-weight: bold;
      margin-top: 15px;
    }
  </style>
</head>
<body>
  <h2>Nuevo proveedor</h2>
  <form id="formProveedor">
    <label>Nombre: <input type="text" id="nombreProveedor" required></label>
    <label>DNI/CIF: <input type="text" id="dniProveedor"></label>
    <label>Teléfono: <input type="text" id="telefonoProveedor"></label>
    <label>Dirección: <input type="text" id="direccionProveedor"></label>
    <label>Población: <input type="text" id="poblacionProveedor"></label>
    <label>Tipo:
      <select id="tipoProveedor">
        <option value="fisica">Persona física (12%)</option>
        <option value="empresa">Empresa (4%)</option>
      </select>
    </label>
    <label>Régimen fiscal:
      <select id="regimenProveedor">
        <option value="general">General</option>
        <option value="agrario">Especial Agrario</option>
      </select>
    </label>
    <button type="button" onclick="guardarProveedor()">Guardar proveedor</button>
  </form>

  <h2>Nuevo contrato</h2>
  <form id="formContrato">
    <label>Seleccionar proveedor:
      <select id="selectProveedor" onchange="cargarProveedor()">
        <option value="">-- Selecciona un proveedor --</option>
      </select>
    </label>
    <div id="datosProveedor"></div>

    <label>Variedad:
      <select id="variedad">
        <option value="Navelina">Navelina</option>
        <option value="Lane late">Lane late</option>
        <option value="Valencia late">Valencia late</option>
        <option value="otra">Otra (especificar)</option>
      </select>
    </label>
    <input type="text" id="otraVariedad" placeholder="Especificar otra variedad">

    <label>Precio por kilo (sin IVA): <input type="number" id="precio" step="0.01"></label>
    <label>Estimación de kilos: <input type="number" id="kilos" step="0.01"></label>

    <div class="result">
      <strong>IVA aplicado:</strong> <span id="ivaTexto">--</span><br>
      <strong>Precio con IVA:</strong> <span id="precioConIVA">0.00</span> €/kg<br>
      <strong>Total estimado (con IVA):</strong> <span id="precioTotalEstimado">0.00</span> €
    </div>
  </form>

  <script>
    function guardarProveedor() {
      const proveedor = {
        nombre: document.getElementById('nombreProveedor').value,
        dni: document.getElementById('dniProveedor').value,
        telefono: document.getElementById('telefonoProveedor').value,
        direccion: document.getElementById('direccionProveedor').value,
        poblacion: document.getElementById('poblacionProveedor').value,
        tipo: document.getElementById('tipoProveedor').value,
        regimen: document.getElementById('regimenProveedor').value
      };

      let proveedores = JSON.parse(localStorage.getItem('proveedores')) || [];
      proveedores.push(proveedor);
      localStorage.setItem('proveedores', JSON.stringify(proveedores));
      alert('Proveedor guardado correctamente');
      cargarListaProveedores();
      document.getElementById('formProveedor').reset();
    }

    function cargarListaProveedores() {
      const select = document.getElementById('selectProveedor');
      select.innerHTML = '<option value="">-- Selecciona un proveedor --</option>';
      const proveedores = JSON.parse(localStorage.getItem('proveedores')) || [];
      proveedores.forEach((prov, index) => {
        const option = document.createElement('option');
        option.value = index;
        option.textContent = prov.nombre;
        select.appendChild(option);
      });
    }

    function cargarProveedor() {
      const index = document.getElementById('selectProveedor').value;
      const proveedores = JSON.parse(localStorage.getItem('proveedores')) || [];
      if (index === "") return;
      const p = proveedores[index];

      const iva = p.tipo === "fisica" ? 0.12 : 0.04;
      document.getElementById('ivaTexto').textContent = p.tipo === "fisica" ? "12%" : "4%";

      document.getElementById('datosProveedor').innerHTML = `
        <p><strong>DNI:</strong> ${p.dni}</p>
        <p><strong>Teléfono:</strong> ${p.telefono}</p>
        <p><strong>Dirección:</strong> ${p.direccion}</p>
        <p><strong>Población:</strong> ${p.poblacion}</p>
        <p><strong>Régimen fiscal:</strong> ${p.regimen}</p>
      `;

      calcularPrecio(iva);
      document.getElementById('precio').oninput = () => calcularPrecio(iva);
      document.getElementById('kilos').oninput = () => calcularPrecio(iva);
    }

    function calcularPrecio(iva) {
      const precio = parseFloat(document.getElementById('precio').value) || 0;
      const kilos = parseFloat(document.getElementById('kilos').value) || 0;
      const precioIVA = precio * (1 + iva);
      const total = precioIVA * kilos;

      document.getElementById('precioConIVA').textContent = precioIVA.toFixed(2);
      document.getElementById('precioTotalEstimado').textContent = total.toFixed(2);
    }

    window.onload = cargarListaProveedores;
  </script>
</body>
</html>
