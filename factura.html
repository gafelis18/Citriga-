<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Facturas - Citriga</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>Facturación</h1>
    <nav>
      <a href="dashboard.html">Dashboard</a>
      <a href="clientes.html">Clientes</a>
      <a href="proveedores.html">Proveedores</a>
      <a href="contratos.html">Contratos</a>
      <a href="albaranes.html">Albaranes</a>
      <a href="anticipos.html">Anticipos</a>
    </nav>
  </header>

  <main>
    <p>Generación de facturas en base a albaranes y contratos.</p>
    <button onclick="generarFactura()">Generar PDF</button>
    <div id="facturaPreview">
      <!-- Aquí se visualizará la factura generada -->
    </div>
  </main>

  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
  <script src="firebase-config.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const db = firebase.firestore();

    async function generarFactura() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      const snapshot = await db.collection('albaranes').get();
      let y = 20;
      doc.text('Factura Citriga', 10, 10);
      snapshot.forEach(docItem => {
        const d = docItem.data();
        doc.text(`${d.fecha} - ${d.proveedor} - ${d.kilos} kg - ${d.cliente}`, 10, y);
        y += 10;
      });

      doc.save('factura.pdf');
    }
  </script>
</body>
</html>
